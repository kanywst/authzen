# AuthZEN 仕様適合性評価

このドキュメントでは、サンプルアプリケーションがAuthZEN仕様にどのように準拠しているかを評価します。

## 概要

AuthZEN（Authorization API）は、Policy Decision Point（PDP）とPolicy Enforcement Point（PEP）間の通信を標準化するための仕様です。サンプルアプリケーションは、この仕様に基づいて実装されています。

## 仕様適合性

### 情報モデル

サンプルアプリケーションは、AuthZEN仕様で定義されている情報モデルを正確に実装しています：

- **Subject（主体）**: `api/models.go`で定義されている`Subject`構造体は、仕様通りに`type`、`id`、`properties`フィールドを持っています。
- **Resource（リソース）**: `api/models.go`で定義されている`Resource`構造体は、仕様通りに`type`、`id`、`properties`フィールドを持っています。
- **Action（アクション）**: `api/models.go`で定義されている`Action`構造体は、仕様通りに`name`と`properties`フィールドを持っています。
- **Context（コンテキスト）**: `api/models.go`で定義されている`Context`型は、仕様通りに任意のJSONオブジェクトを表現できます。

### API

サンプルアプリケーションは、AuthZEN仕様で定義されている以下のAPIを実装しています：

- **Access Evaluation API**: `/access/v1/evaluation`エンドポイントで実装されており、単一の認可判断を行います。
- **Access Evaluations API**: `/access/v1/evaluations`エンドポイントで実装されており、複数の認可判断を一度に行います。
- **Subject Search API**: `/access/v1/search/subject`エンドポイントで実装されており、特定の条件に一致するSubjectを検索します。
- **Resource Search API**: `/access/v1/search/resource`エンドポイントで実装されており、特定の条件に一致するResourceを検索します。
- **Action Search API**: `/access/v1/search/action`エンドポイントで実装されており、特定の条件に一致するActionを検索します。

### メタデータディスカバリー

サンプルアプリケーションは、仕様通りに`/.well-known/authzen-configuration`エンドポイントを実装しており、PDPのメタデータを取得できます。

### トランスポート

サンプルアプリケーションは、仕様で定義されているHTTPSバインディングを実装しています。ただし、開発環境では簡単のためにHTTPも使用できるようになっています。

### エラーハンドリング

サンプルアプリケーションは、仕様で定義されているエラーハンドリングを実装しています：

- 400 Bad Request: リクエストボディのパース失敗など
- 401 Unauthorized: 認証失敗（サンプルアプリケーションでは簡単のため認証は実装されていません）
- 403 Forbidden: 認証されたが、APIへのアクセス権限がない場合
- 500 Internal Server Error: サーバー内部でエラーが発生した場合

## 評価セマンティクス

サンプルアプリケーションは、Access Evaluations APIで以下の評価セマンティクスをサポートしています：

- `execute_all`: すべてのリクエストを実行し、すべての結果を返します（デフォルト）
- `deny_on_first_deny`: 最初の拒否で拒否します
- `permit_on_first_permit`: 最初の許可で許可します

## 拡張性

サンプルアプリケーションは、AuthZEN仕様の基本的な機能を実装していますが、以下の点で拡張可能です：

- ポリシーストアの永続化
- より複雑な認可ロジックの実装
- キャッシングの追加
- 監査ログの実装
- 管理APIの追加

## 注意点

1. **認証機能**: サンプルアプリケーションでは、簡単のために認証機能は実装されていません。実際の本番環境では、OAuth 2.0などの認証メカニズムを実装する必要があります。

2. **ポリシーストア**: サンプルアプリケーションでは、インメモリのポリシーストアを使用しています。実際の本番環境では、データベースなどの永続的なストレージを使用することが推奨されます。

3. **TLS**: サンプルアプリケーションでは、デフォルトではTLS（HTTPS）は有効になっていませんが、`--tls`フラグと`--cert`、`--key`フラグを使用して有効にすることができます。実際の本番環境では、常にTLSを使用することが推奨されます。

4. **エラーメッセージ**: サンプルアプリケーションでは、エラーメッセージは英語で返されます。実際の本番環境では、多言語対応を検討することが推奨されます。

## 結論

サンプルアプリケーションは、AuthZEN仕様に準拠しており、基本的な機能を正確に実装しています。いくつかの注意点はありますが、これらは実装の詳細であり、仕様自体への準拠には影響しません。

サンプルアプリケーションは、AuthZEN仕様の理解と実装の参考として十分に役立つものとなっています。
